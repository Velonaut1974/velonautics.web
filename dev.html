<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Velonaut | Core Technical Specification</title>

<style>
:root {
    --main-blue: #0f64a9;
    --dark: #1a1a1a;
    --light: #f8fafc;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.65;
    margin: 0;
    background: #ffffff;
    color: #222;
}

header {
    background: var(--dark);
    color: white;
    padding: 80px 20px;
    text-align: center;
}

header h1 {
    margin: 0;
    font-size: 36px;
    font-weight: 600;
}

header p {
    margin-top: 15px;
    color: #bbb;
    font-size: 16px;
}

.container {
    max-width: 950px;
    margin: auto;
    padding: 60px 20px;
}

h2 {
    margin-top: 60px;
    font-size: 20px;
    color: var(--main-blue);
    text-transform: uppercase;
    letter-spacing: 1px;
}

h3 {
    margin-top: 30px;
    font-size: 16px;
    color: #333;
}

code {
    background: #f4f4f4;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: monospace;
    color: var(--main-blue);
}

pre {
    background: #1f2937;
    color: #fff;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 13px;
}

ul {
    margin-top: 10px;
}

li {
    margin-bottom: 10px;
}

.diagram {
    margin: 50px 0;
    text-align: center;
}

.footer {
    text-align: center;
    margin-top: 80px;
    padding-top: 40px;
    border-top: 1px solid #eee;
    font-size: 14px;
    color: #666;
}
    svg {
    max-width: 100%;
    height: auto;
}

</style>
</head>
<body>

<header>
    <h1>Velonaut Core Technical Specification</h1>
    <p>Deterministic Regulatory Accounting & Forensic Ledger Architecture (v0.5.6)</p>
</header>

<div class="container">

<h2>0. System Overview — The Deterministic Pipeline</h2>

<p>
Velonaut Core operates as a three-step deterministic pipeline. The system does not manage state; it manages proof.
</p>

<ul>
<li><strong>Ingestion & Casting:</strong> Raw physical energy data (MJ, GHG intensity, scope factors) is ingested and immediately cast into Decimal-native representations to eliminate binary floating-point artifacts.</li>

<li><strong>Regulatory Appraisal:</strong> Events are evaluated against frozen regulatory constants (FuelEU targets, ETS phase-in factors). The result forms a deterministic compliance balance.</li>

<li><strong>Ledger Commitment:</strong> The physical snapshot and regulatory context are sealed via a dual-hash anchor and an HMAC signature.</li>
</ul>

<p>
The current system state is never assumed authoritative. It is reconstructed from the append-only ledger to ensure forensic auditability.
</p>


<h2>1. Architectural Principle — Deterministic Accounting</h2>

<p>
Velonaut Core follows an <strong>Append-Only Ledger Projection</strong> model.
</p>

<ul>
<li><strong>Zero-Trust Projection:</strong> The system state is a projection of verified historical events, not a static database record.</li>

<li><strong>Forensic Replay:</strong> Upon every boot cycle, the engine executes a full replay of the ledger from the first committed entry to the present.</li>

<li><strong>Logic Versioning:</strong> Calculation rules (FuelEU targets, ETS factors) are frozen within each ledger entry. Replay is executed using the rule-version bound to that entry.</li>
</ul>


<h2>2. Mathematical Integrity — Arithmetic Sovereignty</h2>

<p>
To eliminate IEEE-754 floating-point inaccuracies, Velonaut Core uses a native Decimal pipeline.
</p>

<ul>
<li><strong>Decimal Native:</strong> Python <code>decimal</code> module with a context precision of 28 decimal places.</li>

<li><strong>Zero-Float Policy:</strong> Immediate string-casting of physical inputs upon ingestion.</li>

<li><strong>Quantization:</strong> <code>ROUND_HALF_UP</code> for terminal calculations.</li>

<li><strong>String-Sovereignty:</strong> All numeric values in transit (JSON/API) are serialized as Strings to ensure deterministic hashing across runtimes (Python, Go, Rust, JS).</li>
</ul>


<h2>3. Cryptographic Security Model</h2>

<h3>A. Regulatory Anchor (reg_hash)</h3>

<pre>reg_hash = SHA256(CanonicalJSON(Events, Rules, EngineVersion))</pre>

<p>
Proves that specific physical evidence was appraised under a specific rule set.
</p>

<h3>B. Chained Asset Anchor (asset_hash)</h3>

<pre>asset_hash = SHA256(prev_hash + reg_hash + payload)</pre>

<p>
Creates a cryptographically linked history. Any past alteration invalidates all subsequent entries.
</p>

<h3>C. Cryptographic Sealing (HMAC-SHA256)</h3>

<p>
Each ledger entry is sealed using HMAC-SHA256 with a server-side secret.
</p>

<ul>
<li><strong>Provisioning:</strong> SECRET_KEY is supplied via secure environment configuration (environment variables or secret managers).</li>

<li><strong>Verification:</strong> Uses <code>hmac.compare_digest()</code> to mitigate timing attacks.</li>
</ul>


<h2>4. Forensic Validation Protocol</h2>

<p>The engine performs five mandatory checks:</p>

<ul>
<li><strong>Signature Audit:</strong> Validates the HMAC seal.</li>
<li><strong>Sequence Integrity:</strong> Ensures <code>seq</code> is strictly monotonic (n, n+1).</li>
<li><strong>Chain Integrity:</strong> Verifies <code>prev_hashₙ ≡ asset_hashₙ₋₁</code>.</li>
<li><strong>Timestamp Monotony:</strong> Enforces strictly monotonic UTC timestamps within the ledger sequence.</li>
<li><strong>Deterministic Replay:</strong> Re-calculates volume from raw physical events and enforces exact equality under the configured Decimal context.</li>
</ul>


<h2>5. Trust Boundary Model</h2>

<p>
Velonaut explicitly separates physical truth, regulatory logic, and cryptographic sealing.
</p>

<div class="diagram">
<svg width="600" height="340" viewBox="0 0 600 340" xmlns="http://www.w3.org/2000/svg">

<!-- Physical Layer -->
<rect x="150" y="20" width="300" height="70" fill="#f1f5f9" stroke="#0f64a9" stroke-width="2"/>
<text x="300" y="55" text-anchor="middle" font-size="14" font-weight="bold">Physical Energy Events</text>
<text x="300" y="75" text-anchor="middle" font-size="12">(MJ, GHG, Scope)</text>

<!-- Regulatory Layer -->
<rect x="150" y="130" width="300" height="70" fill="#ffffff" stroke="#0f64a9" stroke-width="2"/>
<text x="300" y="165" text-anchor="middle" font-size="14" font-weight="bold">Regulatory Rule Snapshot</text>
<text x="300" y="185" text-anchor="middle" font-size="12">(FuelEU Targets, ETS Factors)</text>

<!-- Ledger Layer -->
<rect x="150" y="240" width="300" height="70" fill="#f1f5f9" stroke="#0f64a9" stroke-width="2"/>
<text x="300" y="275" text-anchor="middle" font-size="14" font-weight="bold">Append-Only Ledger</text>
<text x="300" y="295" text-anchor="middle" font-size="12">(reg_hash + asset_hash + HMAC)</text>

<!-- Arrows -->
<line x1="300" y1="90" x2="300" y2="130" stroke="#0f64a9" stroke-width="2"/>
<line x1="300" y1="200" x2="300" y2="240" stroke="#0f64a9" stroke-width="2"/>

</svg>
</div>

<p>
Trust Boundary Summary:
</p>

<ul>
<li>Physical data is immutable once committed.</li>
<li>Regulatory constants are version-bound per entry.</li>
<li>Ledger integrity is enforced cryptographically.</li>
<li>The UI layer is explicitly outside the trust boundary.</li>
</ul>


<h2>6. Non-Goals</h2>

<ul>
<li>No decentralized consensus or mining.</li>
<li>No financial token minting.</li>
<li>No custody of funds or wallet management.</li>
<li>No carbon market speculation.</li>
</ul>


<h2>7. Technical Roadmap</h2>

<ul>
<li><strong>v0.6:</strong> Append-only SQLite schema with BEFORE UPDATE/DELETE triggers (ABORT).</li>
<li><strong>v0.7:</strong> Period Closure Markers (Yearly Freeze).</li>
<li><strong>v0.8:</strong> Optional public timestamp anchoring (e.g., OpenTimestamps).</li>
</ul>


<h2>8. Canonicalization Standards</h2>

<ul>
<li>Alphabetical keys: <code>sort_keys=True</code></li>
<li>Compact JSON: <code>separators=(',',':')</code></li>
<li>UTF-8 encoding</li>
<li>Numeric values serialized as Strings</li>
</ul>

<div class="footer">
Velonaut Core — Deterministic Infrastructure for Regulatory Accounting<br>
Audit-Oriented Design | Maritime Integrity Architecture
</div>

</div>
</body>
</html>
